#!/bin/bash

# source /opt/cpm/bin/common/run_cmd.sh
# run_cmd_synchronus "pg_controldata" "$@"

SOCKET=crunchy-pg ASYNC=false /opt/cpm/bin/common/run_cmd.sh "pg_controldata" "$@"

# printf "executing pg_controldata in sidecar\n"

# while read -r line
# do
#     if [[ "${line:0:9}" == "EXIT_CODE" ]]
#     then
#         line_arr=(${line})
#         exit_code=${line_arr[1]}
#         printf "EXIT_CODE found, exiting with code %s\n" "${exit_code}"
#         exit "${exit_code}"
#     fi
#     printf "%s\n" "${line}"
# done < <(echo "pg_controldata$(printf ' %q' "$@")" | socat -t 1 /crunchyadm/pgo.sock -,ignoreeof)

# printf "finished executing pg_controldata in sidecar\n"

# echo "pg_controldata $(printf ' %q' "$@")" | socat -t 1 /crunchyadm/pgo.sock -
